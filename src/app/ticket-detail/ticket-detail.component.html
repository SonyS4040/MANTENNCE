<div class="ticket-detail-container">
  <div class="page-actions">
    <a routerLink="/tickets" class="back-link">&larr; العودة إلى قائمة الأعطال</a>
    @if(ticket()){
      <a [routerLink]="['/tickets', ticket()!.id, 'print']" class="print-btn">طباعة التقرير</a>
    }
  </div>
  
  @if (isLoading()) {
    <p class="loading-message">جاري تحميل تفاصيل العطل...</p>
  } @else if (error()) {
    <div class="error-message">{{ error() }}</div>
  } @else if (ticket()) {
    <header class="ticket-header">
      <h1>تفاصيل العطل رقم: {{ ticket()!.ticket_ref }}</h1>
      <div class="header-meta">
        <span class="status" [ngClass]="'status-' + ticket()!.status">{{ ticket()!.status }}</span>
        <span class="priority" [ngClass]="'priority-' + ticket()!.priority">{{ ticket()!.priority }}</span>
      </div>
    </header>

    <div class="ticket-content">
      <app-ticket-actions [ticket]="ticket()!" (ticketUpdated)="handleTicketUpdate($event)"></app-ticket-actions>
      <app-ticket-costs [ticketId]="ticket()!.id"></app-ticket-costs>
      <app-ticket-report-form [ticket]="ticket()!" (ticketUpdated)="handleTicketUpdate($event)"></app-ticket-report-form>
      <app-ticket-info [ticket]="ticket()!"></app-ticket-info>
    </div>
  }
</div>