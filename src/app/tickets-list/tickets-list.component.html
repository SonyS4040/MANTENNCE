<div class="tickets-container">
  <h2>متابعة الأعطال</h2>
  
  @if (isLoading) {
    <p>جاري تحميل قائمة الأعطال...</p>
  } @else if (error) {
    <div class="error-message">
      <p>{{ error }}</p>
    </div>
  } @else {
    <div class="filters-container">
      <div class="filter-group">
        <input 
          type="text" 
          placeholder="ابحث بالاسم أو الرقم المرجعي..." 
          [(ngModel)]="searchTerm"
          class="search-input">
      </div>
      <div class="filter-group">
        <input 
          type="date" 
          [(ngModel)]="searchDate"
          class="date-input">
      </div>
      <button (click)="clearFilters()" class="clear-btn">مسح الفلاتر</button>
    </div>

    @if (tickets().length === 0) {
      <p class="no-results">لا توجد أعطال مسجلة حالياً.</p>
    } @else if (filteredTickets().length === 0) {
      <p class="no-results">لا توجد نتائج تطابق بحثك.</p>
    } @else {
      <div class="table-responsive">
        <table class="tickets-table">
          <thead>
            <tr>
              <th>الرقم المرجعي</th>
              <th>اسم العميل</th>
              <th>نوع الجهاز</th>
              <th>تاريخ الإنشاء</th>
              <th>الأولوية</th>
              <th>الحالة</th>
              <th>الإجراءات</th>
            </tr>
          </thead>
          <tbody>
            @for (ticket of filteredTickets(); track ticket.id) {
              <tr (click)="navigateToDetail(ticket.id)" class="ticket-row">
                <td>{{ ticket.ticket_ref }}</td>
                <td>{{ ticket.customer_name }}</td>
                <td>{{ ticket.device_type }}</td>
                <td>{{ ticket.created_at | date:'yyyy/MM/dd hh:mm a' }}</td>
                <td>
                  <span class="priority" [ngClass]="'priority-' + ticket.priority">{{ ticket.priority }}</span>
                </td>
                <td>
                  <span class="status" [ngClass]="'status-' + ticket.status">{{ ticket.status }}</span>
                </td>
                <td class="actions">
                  <button (click)="deleteTicket(ticket.id, ticket.ticket_ref, $event)" class="delete-btn">حذف</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  }
</div>