<div class="actions-grid">
  <div class="detail-section update-section">
    <h3>تحديث حالة العطل</h3>
    <form [formGroup]="statusUpdateForm" (ngSubmit)="updateTicketStatus()" class="status-form">
      <select formControlName="newStatus">
        @for(status of availableStatuses; track status) {
          <option [value]="status">{{ status }}</option>
        }
      </select>
      <button type="submit" [disabled]="isUpdatingStatus() || ticket.status === statusUpdateForm.value.newStatus">
        @if(isUpdatingStatus()) { <span>جاري التحديث...</span> } @else { <span>تحديث الحالة</span> }
      </button>
    </form>
  </div>

  <div class="detail-section update-section">
    <h3>تعيين مهندس</h3>
    <form [formGroup]="engineerAssignmentForm" (ngSubmit)="assignEngineer()" class="status-form">
      <select formControlName="engineerId">
        <option [ngValue]="null" disabled>اختر مهندساً...</option>
        @for(engineer of engineers(); track engineer.id) {
          <option [value]="engineer.id">{{ engineer.name }}</option>
        }
      </select>
      <button type="submit" [disabled]="isAssigningEngineer() || engineerAssignmentForm.invalid">
        @if(isAssigningEngineer()) { <span>جاري التعيين...</span> } @else { <span>تعيين</span> }
      </button>
    </form>
  </div>
</div>

<!-- New WhatsApp Section -->
<div class="detail-section update-section whatsapp-section">
  <h3>إرسال فيديوهات واتساب للعميل</h3>
  <div class="whatsapp-actions">
    <!-- Before Repair Video -->
    <div class="whatsapp-action-item">
      <h4>فيديو قبل الإصلاح</h4>
      @if (ticket.before_repair_video_url) {
        <p class="video-status success">تم رفع الفيديو بنجاح.</p>
      }
      <div class="form-group">
        <label for="before_repair_video">اختر فيديو</label>
        <input type="file" id="before_repair_video" (change)="onVideoChange($event, 'before')" accept="video/*">
      </div>
      <button (click)="uploadAndSendVideo('before')" [disabled]="!selectedVideos['before'] || isSendingVideo['before']">
        @if(isSendingVideo['before']) { <span>جاري الرفع والإرسال...</span> } @else { <span>رفع وإرسال</span> }
      </button>
    </div>

    <!-- After Repair Video -->
    <div class="whatsapp-action-item">
      <h4>فيديو بعد الإصلاح</h4>
      @if (ticket.repair_video_url) {
        <p class="video-status success">تم رفع الفيديو بنجاح.</p>
      }
      <div class="form-group">
        <label for="after_repair_video">اختر فيديو</label>
        <input type="file" id="after_repair_video" (change)="onVideoChange($event, 'after')" accept="video/*">
      </div>
      <button (click)="uploadAndSendVideo('after')" [disabled]="!selectedVideos['after'] || isSendingVideo['after']">
        @if(isSendingVideo['after']) { <span>جاري الرفع والإرسال...</span> } @else { <span>رفع وإرسال</span> }
      </button>
    </div>
  </div>
</div>